<!DOCTYPE html>
<html>
<head>
    <title>Dashboard | Digital Habit Mirror</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">

    <!-- NAV BAR -->
    <div class="nav">
        <h2>ğŸ“Š Dashboard</h2>
        <div>
            <a href="/log">â• Log Habit</a>
            <a href="/goals">ğŸ¯ Goals</a>
            <a href="/insights">ğŸ“ˆ Insights</a>
            <a href="/logout">ğŸšª Logout</a>
        </div>
    </div>

    <!-- WEEKLY SUMMARY -->
    {% if summary %}
    <div class="container" style="margin-bottom:30px;">
        <h3>ğŸ“… Weekly Summary (Last 7 Days)</h3>
        <p>ğŸ“˜ <b>Total Study Hours:</b> {{ summary.total_study }}</p>
        <p>ğŸ“± <b>Average Phone Usage:</b> {{ summary.avg_phone }} hrs/day</p>
        <p>ğŸ˜´ <b>Average Sleep:</b> {{ summary.avg_sleep }} hrs/day</p>
        <p>ğŸ˜Š <b>Most Common Mood:</b> {{ summary.mood }}</p>
    </div>
    {% endif %}

    <!-- HABIT STREAKS -->
    <div class="container" style="margin-bottom:30px;">
        <h3>ğŸ”¥ Habit Streaks</h3>
        <p>âœ… <b>Current Streak:</b> {{ current_streak }} day(s)</p>
        <p>ğŸ† <b>Longest Streak:</b> {{ longest_streak }} day(s)</p>
    </div>

    <!-- FOCUS SCORE -->
    <div class="container" style="margin-bottom:30px;">
        <h3>ğŸ¯ Focus Score</h3>
        <h2>{{ focus_score }}/100</h2>

        {% if focus_score >= 75 %}
            <p style="color:green;">Excellent focus this week ğŸ‘</p>
        {% elif focus_score >= 50 %}
            <p style="color:orange;">Average focus â€” can improve ğŸ‘</p>
        {% else %}
            <p style="color:red;">Low focus â€” reduce phone usage âš ï¸</p>
        {% endif %}
    </div>

    <!-- STUDY GOALS -->
    <div class="container" style="margin-bottom:30px;">
        <h3>ğŸ¯ Study Goals</h3>

        <p>ğŸ“˜ Daily Goal: <b>{{ daily_goal }} hrs</b></p>
        <p>ğŸ“… Weekly Goal: <b>{{ weekly_goal }} hrs</b></p>

        <p>
            Today Studied: {{ goal_progress.today_study }} hrs
            {% if goal_progress.daily_done %}
                âœ… Goal achieved
            {% else %}
                âŒ Goal pending
            {% endif %}
        </p>

        <p>
            Weekly Studied: {{ goal_progress.weekly_study }} hrs
            {% if goal_progress.weekly_done %}
                âœ… Goal achieved
            {% else %}
                âŒ Goal pending
            {% endif %}
        </p>

        <a href="/goals">âœï¸ Set / Update Goals</a>
    </div>

    <!-- WEEKLY TREND LINE CHART -->
    <div class="container" style="margin-bottom:30px;">
        <h3>ğŸ“‰ Weekly Habit Trend</h3>
        <canvas id="weeklyTrendChart"></canvas>
    </div>

    <!-- HABIT HISTORY -->
    <h3>ğŸ—‚ Habit History</h3>

    <table>
        <tr>
            <th>Date</th>
            <th>Study (hrs)</th>
            <th>Phone (hrs)</th>
            <th>Sleep (hrs)</th>
            <th>Mood</th>
        </tr>

        {% for h in habits %}
        <tr>
            <td>{{ h[4] }}</td>
            <td>{{ h[0] }}</td>
            <td>{{ h[1] }}</td>
            <td>{{ h[2] }}</td>
            <td>{{ h[3] }}</td>
        </tr>
        {% endfor %}
    </table>

</div>

<!-- CHART SCRIPT -->
<script>
new Chart(document.getElementById("weeklyTrendChart"), {
    type: "line",
    data: {
        labels: {{ chart_dates | safe }},
        datasets: [
            {
                label: "Study Hours",
                data: {{ study_data | safe }},
                borderColor: "#667eea",
                tension: 0.3,
                fill: false
            },
            {
                label: "Phone Usage",
                data: {{ phone_data | safe }},
                borderColor: "#f56565",
                tension: 0.3,
                fill: false
            },
            {
                label: "Sleep Hours",
                data: {{ sleep_data | safe }},
                borderColor: "#48bb78",
                tension: 0.3,
                fill: false
            }
        ]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: "bottom"
            }
        }
    }
});
</script>

</body>
</html>
